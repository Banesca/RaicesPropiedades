<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <h3
        *ngIf="mFormaEstado == enCRUD.Eliminar"
        class="py-5 text-center font-weight-bold"
      >
        Usuarios
      </h3>
      <h3
        *ngIf="mFormaEstado == enCRUD.Crear"
        class="py-5 text-center font-weight-bold"
      >
        Nuevo Usuario
      </h3>
      <h3
        *ngIf="mFormaEstado == enCRUD.Actualizar"
        class="py-5 text-center font-weight-bold"
      >
        Actualizar Usuario
      </h3>
      <h3 *ngIf="mFormaEstado == enCRUD.Leer" class="py-5 text-center font-weight-bold">
            Detalles del Usuario
      </h3>
      <h3
        *ngIf="mFormaEstado == enCRUD.Asignar"
        class="py-5 text-center font-weight-bold"
      >
        Asignar Módulos
      </h3>      
      <div
        class="d-flex row justify-content-between"
        *ngIf="
          mFormaEstado != enCRUD.Crear &&
          mFormaEstado != enCRUD.Actualizar &&
          mFormaEstado != enCRUD.Asignar
        "
      >
        <div class="col-md-12">
          <form
            [formGroup]="filterForm"
            class="d-flex align-items-center m-2"
            *ngIf="
              mFormaEstado != enCRUD.Crear &&
              mFormaEstado != enCRUD.Actualizar &&
              mFormaEstado != enCRUD.Asignar &&
            mFormaEstado != enCRUD.Leer
            "
          >
            <div class="col-md-2">
              <button
                (click)="nuevo()"
                type="button"
                class="btn btn-success btn-block"
              >
                <i class="fa fa-plus"></i>
                Nuevo
              </button>
            </div>
            <div class="form-group col-md-8 mb-0">
              <input
                type="text"
                placeholder="Buscar por nombre, usuario o mail"
                formControlName="search"
                class="form-control"
              />
            </div>
            <div class="col-md-2">
              <button
                type="button"
                class="btn btn-success btn-block"
                (click)="filtrar()"
                [disabled]="mLoading"
              >
                Buscar
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="col-md-12">
        <div *ngIf="mFormaEstado == enCRUD.Eliminar">
          <div class="row animated fadeIn fast">
            <div class="col-md-12">
              <div class="table-responsive">
                <table class="table table-striped">
                  <thead class="thead-dark">
                    <th>#</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Acción</th>
                  </thead>
                  <tbody>
                    <tr
                      *ngFor="let categoria of mCategorias; let i = index"
                      (dblclick)="modificar(categoria)"
                    >
                      <td>{{ i + 1 }}</td>
                      <td>{{ categoria.name }}</td>
                      <td>{{ categoria.email }}</td>
                      <td>
                        <button
                          (click)="ver(categoria)"
                          type="button"
                          class="btn mr-2 btn-info"
                        >
                          <i class="far fa-eye"></i>
                        </button>
                        <button
                          (click)="modificar(categoria)"
                          type="button"
                          class="btn mr-2 btn-primary"
                        >
                          <i class="fas fa-pencil-alt"></i>
                        </button>
                        <!-- <button
                          (click)="modulos(categoria.id)"
                          type="button"
                          class="btn mr-2 btn-info"
                        >
                          <i class="fa fa-cogs"></i>
                        </button> -->
                        <button
                          (click)="eliminar(categoria.id)"
                          type="button"
                          class="btn mr-2 btn-danger"
                        >
                          <i class="fa fa-trash"></i>
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
                <div
                  *ngIf="(mCategorias | keys).length === 0 && !mLoading"
                  class="alert alert-info"
                  role="alert"
                >
                  <strong>No existen</strong> Usuarios que mostrar...
                </div>
                <div *ngIf="mLoading" class="alert alert-warning" role="alert">
                  <strong>Cargando</strong> por favor espere...
                </div>
              </div>
            </div>
          </div>
        </div>

        <div
          *ngIf="
            mFormaEstado == enCRUD.Crear ||
            mFormaEstado == enCRUD.Actualizar ||
            mFormaEstado == enCRUD.Asignar
          "
          class="row animated fadeIn fast"
        >
          <div class="col-md-12">
            <div class="row m-2">
              <!-- BOTONES CABECERA-->
              <div class="col-md-12">
                <div class="pull-right">
                  <button
                    (click)="mFormaEstado = enCRUD.Eliminar"
                    type="button"
                    class="btn btn-primary m-2"
                  >
                    <i class="fa fa-backward"></i>
                    Regresar
                  </button>

                  <!-- [disabled]="!vForma.valid" -->
                  <button
                    *ngIf="mFormaEstado == enCRUD.Crear"
                    (click)="onSubmit('create')"
                    class="btn btn-primary m-2"
                  >
                    <i class="fa fa-save"></i>
                    Guardar
                  </button>
                  <button
                    *ngIf="mFormaEstado == enCRUD.Actualizar"
                    (click)="onSubmit('update')"
                    style="margin: 5px"
                    class="btn btn-primary"
                  >
                    <i class="fa fa-save"></i>
                    Modificar
                  </button>
                  <button
                    (click)="asignarModulo()"
                    *ngIf="mFormaEstado == enCRUD.Asignar"
                    class="btn btn-primary"
                  >
                    <i class="fa fa-plus"></i>
                    Asignar Módulos
                  </button>
                </div>
              </div>
              <!--FIN BOTONES CABECERA-->
            </div>
            <div
              *ngIf="
                mFormaEstado == enCRUD.Crear ||
                mFormaEstado == enCRUD.Actualizar
              "
            >
              <form [formGroup]="mForma" #vForma="ngForm">
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="">Nombres</label>
                      <input
                        class="form-control"
                        [(ngModel)]="mCategoriasSelect.name"
                        type="text"
                        formControlName="name"
                        placeholder="Nombre"
                      />
                      <div
                        *ngIf="submitted && f.name.errors"
                        type="alert"
                        class="invalid-feedback d-block"
                      >
                        <div *ngIf="f.name.errors.required">
                          El nombre es Requerido
                        </div>
                        <div *ngIf="f.name.errors.minlength">
                          El password debe tener un mínimo de 2 caracateres
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="">Email</label>
                      <input
                        class="form-control"
                        [(ngModel)]="mCategoriasSelect.email"
                        type="email"
                        formControlName="email"
                        placeholder="Email"
                      />
                      <div
                        *ngIf="submitted && f.email.errors"
                        type="alert"
                        class="invalid-feedback d-block"
                      >
                        <div *ngIf="f.email.errors.required">
                          El email es Requerido
                        </div>
                        <div *ngIf="f.email.errors.pattern">
                          Debe ingresar un email válido
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for=""
                        >Password</label
                      >
                      <input
                        class="form-control"
                        type="password"
                        [(ngModel)]="mCategoriasSelect.password"
                        formControlName="password"
                        placeholder="Password"
                        [required]="requirePasssword"
                      />
                      <div
                        *ngIf="submitted && f.password.errors"
                        type="alert"
                        class="invalid-feedback d-block"
                      >
                        <div *ngIf="f.password.errors.required">
                          El password es Requerido
                        </div>
                      </div>
                      <div *ngIf="f.password.errors" type="alert" class="invalid-feedback d-block">
                        <div *ngIf="f.password.errors.minlength">
                          El password debe tener un mínimo de 8 caracateres
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label for="">Confirmar Password</label>
                      <input
                        class="form-control"
                        type="password"
                        [(ngModel)]="mCategoriasSelect.password_confirmation"
                        formControlName="password_confirmation"
                        placeholder="Confirmar Password"
                        [required]="requirePasssword"
                      />
                      <div
                        *ngIf="submitted && f.password_confirmation.errors"
                        type="alert"
                        class="invalid-feedback d-block"
                      >
                        <div *ngIf="f.password_confirmation.errors.required">
                          La confirmación de la contraseña es requerida
                        </div>
                      </div>
                      <div *ngIf="f.password_confirmation.errors" type="alert" class="invalid-feedback d-block">
                        <div *ngIf="f.password_confirmation.errors.minlength">
                          La confirmación del password debe tener un mínimo de 8
                          caracateres
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div
          *ngIf="mFormaEstado == enCRUD.Leer"
          class="row animated fadeIn fast"
        >
          <div class="col-md-12">
            <form>
              <div class="form-group text-right">
                <button
                  (click)="mFormaEstado = enCRUD.Eliminar"
                  type="button"
                  class="btn btn-primary"
                >
                  <i class="fa fa-backward"></i>
                  Regresar
                </button>
              </div>
              <div class="form-group">
                <label for="">Nombre</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="mCategoriasSelect.name"
                  name="mCategoriasSelect.name"
                  readonly
                />
              </div>

              <div class="form-group">
                <label for="">Email</label>
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="mCategoriasSelect.email"
                  name="mCategoriasSelect.email"
                  readonly
                />
              </div>
            </form>
          </div>
        </div>

        <!-- ASIGANCION DE MODULOS ] -->
        <div *ngIf="mFormaEstado == enCRUD.Asignar">
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <form [formGroup]="mFormM" #vFormM="ngForm">
                  <div *ngFor="let modulo of mModulos; let i = index">
                    <div class="col-md-6">
                      <div class="form-group">
                        <input
                          type="checkbox"
                          class="form-check-input"
                          value="{{ modulo.idModulo }}"
                          (change)="checkBoxvalue($event)"
                        />
                        <!-- <input type="checkbox" class="form-check-input" [value]="modulo.idModulo" formControlName="modulo"> -->
                        <label class="form-check-label" for="exampleCheck1">
                          &nbsp;&nbsp;&nbsp;&nbsp;{{ modulo.modulo }}</label
                        >
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
